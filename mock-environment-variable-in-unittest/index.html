<!DOCTYPE html>
<html lang="en">
<head>

    <title>how to mock environment variables in unittest</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=776d70e7aa" />

    <link rel="canonical" href="https://kapilgarg.github.io/mock-environment-variable-in-unittest/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://kapilgarg.github.io/mock-environment-variable-in-unittest/amp/" />
    
    <meta property="og:site_name" content="basic function" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="how to mock environment variables in unittest" />
    <meta property="og:description" content="While writing test cases, you may need to mock one or more environment variables. It could be because environment variable it used as a flag for certain functionality or something else.

Environment variables are available through os.environ api. Though technically os.environ [1] is not a dictionary but it" />
    <meta property="og:url" content="https://kapilgarg.github.io/mock-environment-variable-in-unittest/" />
    <meta property="article:published_time" content="2022-03-08T04:56:10.000Z" />
    <meta property="article:modified_time" content="2022-03-08T14:58:29.000Z" />
    <meta property="article:tag" content="python" />
    <meta property="article:tag" content="unittest" />
    <meta property="article:tag" content="mock" />
    <meta property="article:tag" content="patch" />
    <meta property="article:tag" content="environmentvariable" />
    <meta property="article:tag" content="programming" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="how to mock environment variables in unittest" />
    <meta name="twitter:description" content="While writing test cases, you may need to mock one or more environment variables. It could be because environment variable it used as a flag for certain functionality or something else.

Environment variables are available through os.environ api. Though technically os.environ [1] is not a dictionary but it" />
    <meta name="twitter:url" content="https://kapilgarg.github.io/mock-environment-variable-in-unittest/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="KAPIL" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="python, unittest, mock, patch, environmentvariable, programming" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "basic function",
        "url": "https://kapilgarg.github.io/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://kapilgarg.github.io/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "KAPIL",
        "url": "https://kapilgarg.github.io/author/kapil-2/",
        "sameAs": []
    },
    "headline": "how to mock environment variables in unittest",
    "url": "https://kapilgarg.github.io/mock-environment-variable-in-unittest/",
    "datePublished": "2022-03-08T04:56:10.000Z",
    "dateModified": "2022-03-08T14:58:29.000Z",
    "keywords": "python, unittest, mock, patch, environmentvariable, programming",
    "description": "While writing test cases, you may need to mock one or more environment variables. It could be because environment variable it used as a flag for certain functionality or something else.\n\nEnvironment variables are available through os.environ api. Though technically os.environ [1] is not a dictionary but it fulfills the criteria [2] so that it can be mocked like a dictionary. unittest module provides a way to achieve this.\n\nmock.patch.dict is the function that we can use to mock a dictionary. Fir",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://kapilgarg.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.1" />
    <link rel="alternate" type="application/rss+xml" title="basic function" href="https://kapilgarg.github.io/rss/" />
    <script defer src="https://unpkg.com/@tryghost/portal@~2.1.0/umd/portal.min.js" data-ghost="https://kapilgarg.github.io/" data-key="6411187770ec86e91904481ed3" data-api="https://kapilgarg.github.io/ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style><style>:root {--ghost-accent-color: #15171A;}</style>
    <!-- link tag -->

</head>
<body class="post-template tag-python tag-unittest tag-mock tag-patch tag-environmentvariable tag-programming has-cover">
<div class="viewport">

    <header id="gh-head" class="gh-head outer">
        <nav class="gh-head-inner inner">

            <div class="gh-head-brand">
                <a class="gh-head-logo no-image" href="https://kapilgarg.github.io">
                        basic function
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="https://kapilgarg.github.io/">Home</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>
                        <a class="gh-head-button" href="#/portal/signup" data-portal="signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
<article class="article post tag-python tag-unittest tag-mock tag-patch tag-environmentvariable tag-programming featured no-image ">

    <header class="article-header gh-canvas">

        <div class="article-tag post-card-tags">
                <span class="post-card-primary-tag">
                    <a href="/tag/python/">python</a>
                </span>
                <span class="post-card-featured"><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M4.49365 4.58752C3.53115 6.03752 2.74365 7.70002 2.74365 9.25002C2.74365 10.6424 3.29678 11.9778 4.28134 12.9623C5.26591 13.9469 6.60127 14.5 7.99365 14.5C9.38604 14.5 10.7214 13.9469 11.706 12.9623C12.6905 11.9778 13.2437 10.6424 13.2437 9.25002C13.2437 6.00002 10.9937 3.50002 9.16865 1.68127L6.99365 6.25002L4.49365 4.58752Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
</svg> Featured</span>
        </div>

        <h1 class="article-title">Mock environment variable in unittest</h1>


        <div class="article-byline">
        <section class="article-byline-content">

            <ul class="author-list">
                <li class="author-list-item">
                    <a href="/author/kapil-2/" class="author-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg>
</a>
                </li>
            </ul>

            <div class="article-byline-meta">
                <h4 class="author-name"><a href="/author/kapil-2/">KAPIL</a></h4>
                <div class="byline-meta-content">
                    <time class="byline-meta-date" datetime="2022-03-08">Mar 8, 2022</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 2 min read</span>
                </div>
            </div>

        </section>
        </div>


    </header>

    <section class="gh-content gh-canvas">
        <p>While writing test cases, you may need to mock one or more environment variables. It could be because environment variable it used as a flag for certain functionality or something else. </p><p>Environment variables are available through <em>os.environ api</em>. Though technically <em>os.environ </em>[1]<em> </em> is not a dictionary but it fulfills the criteria [2] so that it can be mocked like a dictionary. unittest module provides a way to achieve this.</p><p><em>mock.patch.dict</em> is the function that we can use to mock a dictionary. First argument is the target dictionary that you want to mock, 2nd argument is the value (dictionary) that you want your target dictionary to return.</p><pre><code class="language-python">import os
from unittest import TestCase, mock

class FileWriterTests(TestCase):
    @mock.patch.dict(os.environ, {"DESTINATION": "AWS"}, clear=True)
    def test_write_file(self):        
        self.assertEqual(os.environ.get('DESTINATION'), 'AWS')</code></pre><p>The dictionary mocked here will be available through out the test . '<strong>clear=True' </strong>will make sure that dictionary is restored to its original state when the test ends.</p><p>You could also mock this dictionary at class level so that it is available for all the tests.</p><pre><code class="language-python">import os
from unittest import TestCase, mock

@mock.patch.dict(os.environ, {"DESTINATION": "AWS"}, clear=True)
class FileWriterTests(TestCase):    
    def test_write_file(self):        
        self.assertEqual(os.environ.get('DESTINATION'), 'AWS')
        
    def test_read_file(self):        
        self.assertEqual(os.environ.get('DESTINATION'), 'AWS')</code></pre><p>When setting the values in the dictionary, you could also use key words.</p><pre><code>with patch.dict('os.environ', DESTINATION='AWS'):
...     print(os.environ['DESTINATION'])</code></pre><p>Please note that when you patch dict at class level, <em>patched dictionary is only available to test methods starting with 'test_'. </em> This will not be avialable in setUp, tearDown() etc.</p><p>You could also use a function to provide the value for key. If the values of the dictionary are dynamic, you could use context manager to provide the dynamic values </p><pre><code>import os
from unittest import TestCase, mock

class FileWriterTests(TestCase):    
    def test_write_file(self):
    	with patch.dict('os.environ', {"DESTINATION": get_destination()}):
	     	print(os.environ['DESTINATION'])
        	self.assertEqual(os.environ.get('DESTINATION'), 'AWS')</code></pre><p>Hope this helps. </p><p>Happy coding ...</p><hr><p>ref : <a href="https://docs.python.org/3/library/unittest.mock.html#patch-dict">https://docs.python.org/3/library/unittest.mock.html#patch-dict</a></p><p>[1] <a href="https://github.com/python/cpython/blob/4d95fa1ac5d31ff450fb2f31b55ce1eb99d6efcb/Lib/os.py#L665">https://github.com/python/cpython/blob/4d95fa1ac5d31ff450fb2f31b55ce1eb99d6efcb/Lib/os.py#L665</a></p><p>[2] <a href="https://docs.python.org/3/library/unittest.mock.html#unittest.mock.patch.dict"><code>patch.dict()</code></a> can be used with dictionary like objects that aren’t actually dictionaries. At the very minimum they must support item getting, setting, deleting and either iteration or membership test. This corresponds to the magic methods <code>__getitem__()</code>, <code>__setitem__()</code>, <code>__delitem__()</code> and either <code>__iter__()</code> or <code>__contains__()</code>.</p><p></p>
    </section>


</article>
</main>

    <section class="footer-cta outer">
        <div class="inner">
            <h2 class="footer-cta-title">Sign up for more like this.</h2>
            <a class="footer-cta-button" href="#/portal" data-portal>
                <div class="footer-cta-input">Enter your email</div>
                <span>Subscribe</span>
            </a>
        </div>
    </section>



            <aside class="read-more-wrap outer">
                <div class="read-more inner">
                        
<article class="post-card post post-access-public">

    <a class="post-card-image-link" href="/coming-soon/">

        <img class="post-card-image"
            srcset="https://static.ghost.org/v4.0.0/images/feature-image.jpg 300w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 600w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 1000w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="https://static.ghost.org/v4.0.0/images/feature-image.jpg"
            alt="Coming soon"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/coming-soon/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Coming soon
                </h2>
            </header>
                <div class="post-card-excerpt">This is basic function, a brand new site by kapil that's just getting started. Things will be up and running here shortly, but you can subscribe in the meantime if you'd like to stay up to date and receive emails when new content is published!</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-05-30">May 30, 2022</time>
        </footer>

    </div>

</article>
                        
<article class="post-card post no-image post-access-public">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/write-a-file-watcher-and-read-the-delta/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Write a file-watcher and read the delta...
                </h2>
            </header>
                <div class="post-card-excerpt">While working on an on-premise compute grid, there was a need to monitor the status of various jobs running on worker nodes. There is a scheduler which assign tasks to worker nodes and maintains the status of each job. As a job moves through various stages of its life cycle,</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-02-20">Feb 20, 2022</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">1 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post no-image post-access-public">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/recursive-generator-fumctions/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Recursive Generator Functions
                </h2>
            </header>
                <div class="post-card-excerpt">You can find previous post about Python generator function here

This is something I haven't used very often but came up in a discussion.

We know the generator function and recursive function. How do we create a generator function which is recursive.

For example, if we have a binary tree</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2021-10-04">Oct 4, 2021</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">1 min read</span>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="https://kapilgarg.github.io">basic function</a> &copy; 2022</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="/assets/built/casper.js?v=776d70e7aa"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<!-- script tag -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-169335725-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-169335725-1');
</script>

</body>
</html>
