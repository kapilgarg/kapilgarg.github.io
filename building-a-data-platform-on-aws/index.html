<!DOCTYPE html>
<html lang="en">
<head>

    <title>Building data platform on AWS - part 1</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=776d70e7aa" />

    <link rel="canonical" href="https://kapilgarg.github.io/building-a-data-platform-on-aws/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://kapilgarg.github.io/building-a-data-platform-on-aws/amp/" />
    
    <meta property="og:site_name" content="basic function" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Building data platform on AWS - part 1" />
    <meta property="og:description" content="You have joined this startup which wants to build a brand new,  scalable platform. With this it aims to reduces its operating cost and provides  better services to its customer.

The platform in question here is the entire back end system to support  their products.  Since you don&#x27;t want to" />
    <meta property="og:url" content="https://kapilgarg.github.io/building-a-data-platform-on-aws/" />
    <meta property="article:published_time" content="2020-07-25T10:44:56.000Z" />
    <meta property="article:modified_time" content="2020-07-25T10:45:27.000Z" />
    <meta property="article:tag" content="aws" />
    <meta property="article:tag" content="platform" />
    <meta property="article:tag" content="design" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Building data platform on AWS - part 1" />
    <meta name="twitter:description" content="You have joined this startup which wants to build a brand new,  scalable platform. With this it aims to reduces its operating cost and provides  better services to its customer.

The platform in question here is the entire back end system to support  their products.  Since you don&#x27;t want to" />
    <meta name="twitter:url" content="https://kapilgarg.github.io/building-a-data-platform-on-aws/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="KAPIL" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="aws, platform, design" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "basic function",
        "url": "https://kapilgarg.github.io/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://kapilgarg.github.io/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "KAPIL",
        "url": "https://kapilgarg.github.io/author/kapil-2/",
        "sameAs": []
    },
    "headline": "Building data platform on AWS - part 1",
    "url": "https://kapilgarg.github.io/building-a-data-platform-on-aws/",
    "datePublished": "2020-07-25T10:44:56.000Z",
    "dateModified": "2020-07-25T10:45:27.000Z",
    "keywords": "aws, platform, design",
    "description": "You have joined this startup which wants to build a brand new,  scalable platform. With this it aims to reduces its operating cost and provides  better services to its customer.\n\nThe platform in question here is the entire back end system to support  their products.  Since you don&#x27;t want to manage all the infrastructure,  the obvious choice is cloud. So you call your team, cloud gurus for discussion. After some brain storming sessions, team come to conclusion that AWS is the platform which you c",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://kapilgarg.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.1" />
    <link rel="alternate" type="application/rss+xml" title="basic function" href="https://kapilgarg.github.io/rss/" />
    <script defer src="https://unpkg.com/@tryghost/portal@~2.1.0/umd/portal.min.js" data-ghost="https://kapilgarg.github.io/" data-key="6411187770ec86e91904481ed3" data-api="https://kapilgarg.github.io/ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style><style>:root {--ghost-accent-color: #15171A;}</style>
    <!-- link tag -->

</head>
<body class="post-template tag-aws tag-platform tag-design has-cover">
<div class="viewport">

    <header id="gh-head" class="gh-head outer">
        <nav class="gh-head-inner inner">

            <div class="gh-head-brand">
                <a class="gh-head-logo no-image" href="https://kapilgarg.github.io">
                        basic function
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="https://kapilgarg.github.io/">Home</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>
                        <a class="gh-head-button" href="#/portal/signup" data-portal="signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
<article class="article post tag-aws tag-platform tag-design no-image ">

    <header class="article-header gh-canvas">

        <div class="article-tag post-card-tags">
                <span class="post-card-primary-tag">
                    <a href="/tag/aws/">aws</a>
                </span>
        </div>

        <h1 class="article-title">Building data platform on AWS - part 1</h1>


        <div class="article-byline">
        <section class="article-byline-content">

            <ul class="author-list">
                <li class="author-list-item">
                    <a href="/author/kapil-2/" class="author-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg>
</a>
                </li>
            </ul>

            <div class="article-byline-meta">
                <h4 class="author-name"><a href="/author/kapil-2/">KAPIL</a></h4>
                <div class="byline-meta-content">
                    <time class="byline-meta-date" datetime="2020-07-25">Jul 25, 2020</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 5 min read</span>
                </div>
            </div>

        </section>
        </div>


    </header>

    <section class="gh-content gh-canvas">
        <p>You have joined this startup which wants to build a brand new,  scalable platform. With this it aims to reduces its operating cost and provides  better services to its customer. </p><!--kg-card-begin: html--><iframe src="https://giphy.com/embed/e7QPhueuNN6KVc3dK5" width="480" height="480" frameBorder="0"></iframe><!--kg-card-end: html--><p>The platform in question here is the entire back end system to support  their products.  Since you don't want to manage all the infrastructure,  the obvious choice is cloud. So you call your team, cloud gurus for discussion. After some brain storming sessions, team come to conclusion that AWS is the platform which you can use. That wasn't so difficult after all. AWS is scalable, cost effective  and  you are already familiar with it!</p><figure class="kg-card kg-image-card"><img src="https://kapilgarg.github.io/content/images/2020/07/image-12.png" class="kg-image" alt loading="lazy"></figure><hr><h2 id="data">Data</h2><p>The data, this company deals with, is dynamic in nature.  With SQL/Relational DB, we are  going to have tough time. Luckily AWS provides d<em>ynamodb</em> - a No SQL, highly scalable database. That would be a good choice to store the data. </p><p>Products/services use the data in two ways -</p><ol><li><strong>Low volume / real time read</strong> - As soon as data is updated, it should be available for consumption. dynamodb can do that. </li><li><strong>High volume / near real time read - </strong>Reading huge quantity of data but it requires <em>near </em>real  time data. That means , if data is updated now and it is available  after some time (lets say 30 mins from now), that is OK.</li></ol><p>Now for 2nd use case, dynamodb  will be overkill.  You may ask why!!!</p><p>Querying huge quantity of data from dynamodb will be costlier. Since real time access is not a concern, we can think of something cost effective (and  serves the purpose).</p><p>It turns out that AWS also provides S3 which  is way cheaper than dynamo and can also store huge quantity of data. It also makes  data available for consumption by means of Athena which  is another offering on AWS.</p><p>So we decide to keep the data in two  places. In dynamodb for low volume / real time read and in S3 for high  volume / near real time (and we save some money also).</p><figure class="kg-card kg-image-card"><img src="https://kapilgarg.github.io/content/images/2020/07/image-9.png" class="kg-image" alt loading="lazy"></figure><hr><h2 id="sync">Sync</h2><p>But now we have a problem. How do we move data from dynamodb to S3 in near real time? As soon as the data comes to dynamodb, it should also be made available in  S3 which might take some time. After all its a near real time.</p><p>Any  service which is writing data to dynamo db can also write to S3 bucket.  What if writing to dynamo fails?  Would it still write to S3? or if  Write to dynamo succeed but to S3 fails?  Should this be a synchronous  operation . In that case writing operation will end up taking more time.  If we keep this asynchronous, we will have to track all the failures...  a lot of cases to consider!!!</p><p>AWS did the magic again. dynamodb  provides 'real time updates in records' through dynamodb stream . It is more like a pub-sub mechanism where dynamodb publish all the changes.  Client can  subscribe to it and take action (invoke lambda). So we configure this stream  on table and attach a lambda function to it. When ever any record is  inserted/updated, that record is available in stream.  It also triggers the lambda function with those records as arguments to this lambda.</p><p>So  now we have a table which produces a data stream whenever any record is  changed in that . That data stream triggers the lambda which writes  these records in s3. So far so good.</p><figure class="kg-card kg-image-card"><img src="https://kapilgarg.github.io/content/images/2020/07/image-10.png" class="kg-image" alt loading="lazy"></figure><hr><p>Writing data with lambda function to S3 will be inefficient here. because you will be making frequent trips with very small amount of data. It would be better if we could write the data in batches.</p><p>We create a firehose stream to write dynamodb stream data to S3. firehose buffers the records for a given duration before writing those to destination. It is also integrated with S3. So that you can specify an S3 location as destination when you create this stream and forget about that. you just keep pushing the data to firehose stream and it will deliver the data to destination.</p><figure class="kg-card kg-image-card"><img src="https://kapilgarg.github.io/content/images/2020/07/image-11.png" class="kg-image" alt loading="lazy"></figure><hr><p>If you haven't worked with S3, it is an object store where objects are immutable. What that means is , in s3, we will be writing records in file. and any operation is performed in that file and not at the individual record.</p><p>For example, If we push 10 records to firehose,  firehose writes all those 10 records to s3 as an object. Like any database , we can not  manipulate the individual records. It is the object that we can read / write.</p><p>That introduces some complexity. dynamodb contains only one copy/record which is the latest one. But each insert/update is an individual record in dynamodb stream. If we update a record twice, dynamodb stream will contain two individual copy of that record. Each copy will belong to different state. Hence we need to make sure that we update the correct object in S3 to keep only latest copy of record. Since S3 objects are immutable, we need to read the object, update the record and then re write the object back to S3.</p><p>To handle this, we introduce Apache Spark . Spark is capable of handling large quantity of data efficiently. We create a spark job to process  input files/data written by firehose and run it on aws batch. Spark Process updates any existing record with latest record or add a new record to S3 object. </p><p>With this setup , our data is now available in S3 with only latest copy and no duplicates.  Now the only part remaining is how to query this?</p><p>Here athena comes for our rescue. In athena, we can create SQL like table which points to data in S3. We can query these table with SQL like query. Please note that these tables provide read only access to data. You can not update data using these tables. These are good for querying and believe me they perform better with more data . But if you have to update any record, that update has to come from the dynamo and has to pass through the whole chain. This is the tread off for keeping the cost low.</p><figure class="kg-card kg-image-card"><img src="https://kapilgarg.github.io/content/images/2020/07/1-1.png" class="kg-image" alt loading="lazy"></figure><p>This completes the initial design of this platform. In next posts, I'd like to go a little deeper in spark job and list down some of the issue we face with this and the solutions.</p><p></p><p></p><p></p><p></p>
    </section>


</article>
</main>

    <section class="footer-cta outer">
        <div class="inner">
            <h2 class="footer-cta-title">Sign up for more like this.</h2>
            <a class="footer-cta-button" href="#/portal" data-portal>
                <div class="footer-cta-input">Enter your email</div>
                <span>Subscribe</span>
            </a>
        </div>
    </section>



            <aside class="read-more-wrap outer">
                <div class="read-more inner">
                        
<article class="post-card post post-access-public">

    <a class="post-card-image-link" href="/coming-soon/">

        <img class="post-card-image"
            srcset="https://static.ghost.org/v4.0.0/images/feature-image.jpg 300w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 600w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 1000w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="https://static.ghost.org/v4.0.0/images/feature-image.jpg"
            alt="Coming soon"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/coming-soon/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Coming soon
                </h2>
            </header>
                <div class="post-card-excerpt">This is basic function, a brand new site by kapil that's just getting started. Things will be up and running here shortly, but you can subscribe in the meantime if you'd like to stay up to date and receive emails when new content is published!</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-05-30">May 30, 2022</time>
        </footer>

    </div>

</article>
                        
<article class="post-card post featured no-image post-access-public">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/mock-environment-variable-in-unittest/">
            <header class="post-card-header">
                <div class="post-card-tags">
                        <span class="post-card-featured"><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M4.49365 4.58752C3.53115 6.03752 2.74365 7.70002 2.74365 9.25002C2.74365 10.6424 3.29678 11.9778 4.28134 12.9623C5.26591 13.9469 6.60127 14.5 7.99365 14.5C9.38604 14.5 10.7214 13.9469 11.706 12.9623C12.6905 11.9778 13.2437 10.6424 13.2437 9.25002C13.2437 6.00002 10.9937 3.50002 9.16865 1.68127L6.99365 6.25002L4.49365 4.58752Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
</svg> Featured</span>
                </div>
                <h2 class="post-card-title">
                    Mock environment variable in unittest
                </h2>
            </header>
                <div class="post-card-excerpt">While writing test cases, you may need to mock one or more environment variables. It could be because environment variable it used as a flag for certain functionality or something else.

Environment variables are available through os.environ api. Though technically os.environ [1] is not a dictionary but it</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-03-08">Mar 8, 2022</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">2 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post no-image post-access-public">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/write-a-file-watcher-and-read-the-delta/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Write a file-watcher and read the delta...
                </h2>
            </header>
                <div class="post-card-excerpt">While working on an on-premise compute grid, there was a need to monitor the status of various jobs running on worker nodes. There is a scheduler which assign tasks to worker nodes and maintains the status of each job. As a job moves through various stages of its life cycle,</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-02-20">Feb 20, 2022</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">1 min read</span>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="https://kapilgarg.github.io">basic function</a> &copy; 2022</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="/assets/built/casper.js?v=776d70e7aa"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<!-- script tag -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-169335725-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-169335725-1');
</script>

</body>
</html>
