<!DOCTYPE html>
<html lang="en">
<head>

    <title>Capture text from web with flask and JavaScript</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=776d70e7aa" />

    <link rel="canonical" href="https://kapilgarg.github.io/capture-text-from-web-with-flask-and-javascript/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://kapilgarg.github.io/capture-text-from-web-with-flask-and-javascript/amp/" />
    
    <meta property="og:site_name" content="basic function" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Capture text from web with flask and JavaScript" />
    <meta property="og:description" content="We read a lot of stuff from web and sometimes would like to make a note of some of it so that we can refer to it later. There are a few products which charge few $/month and provide this service but we can easily write a browser extension to" />
    <meta property="og:url" content="https://kapilgarg.github.io/capture-text-from-web-with-flask-and-javascript/" />
    <meta property="og:image" content="https://kapilgarg.github.io/content/images/2020/12/janko-ferlic-sfL_QOnmy00-unsplash-2.jpg" />
    <meta property="article:published_time" content="2020-12-26T12:03:02.000Z" />
    <meta property="article:modified_time" content="2020-12-26T12:03:02.000Z" />
    <meta property="article:tag" content="python" />
    <meta property="article:tag" content="flask" />
    <meta property="article:tag" content="browser" />
    <meta property="article:tag" content="extension" />
    <meta property="article:tag" content="sqlalchemy" />
    <meta property="article:tag" content="sideproject" />
    <meta property="article:tag" content="ideas" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Capture text from web with flask and JavaScript" />
    <meta name="twitter:description" content="We read a lot of stuff from web and sometimes would like to make a note of some of it so that we can refer to it later. There are a few products which charge few $/month and provide this service but we can easily write a browser extension to" />
    <meta name="twitter:url" content="https://kapilgarg.github.io/capture-text-from-web-with-flask-and-javascript/" />
    <meta name="twitter:image" content="https://kapilgarg.github.io/content/images/2020/12/janko-ferlic-sfL_QOnmy00-unsplash-2.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="KAPIL" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="python, flask, browser, extension, sqlalchemy, sideproject, ideas" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "basic function",
        "url": "https://kapilgarg.github.io/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://kapilgarg.github.io/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "KAPIL",
        "url": "https://kapilgarg.github.io/author/kapil-2/",
        "sameAs": []
    },
    "headline": "Capture text from web with flask and JavaScript",
    "url": "https://kapilgarg.github.io/capture-text-from-web-with-flask-and-javascript/",
    "datePublished": "2020-12-26T12:03:02.000Z",
    "dateModified": "2020-12-26T12:03:02.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://kapilgarg.github.io/content/images/2020/12/janko-ferlic-sfL_QOnmy00-unsplash-2.jpg"
    },
    "keywords": "python, flask, browser, extension, sqlalchemy, sideproject, ideas",
    "description": "We read a lot of stuff from web and sometimes would like to make a note of some of it so that we can refer to it later. There are a few products which charge few $/month and provide this service but we can easily write a browser extension to capture the text on a web page and save that to a database. Run this service locally if you need this on a single machine, on a raspberry pi in your home network or use a Amazon Lightsail. whatever suits you!!!\n\nHere, I&#x27;m going to write a basic browser exten",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://kapilgarg.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.1" />
    <link rel="alternate" type="application/rss+xml" title="basic function" href="https://kapilgarg.github.io/rss/" />
    <script defer src="https://unpkg.com/@tryghost/portal@~2.1.0/umd/portal.min.js" data-ghost="https://kapilgarg.github.io/" data-key="6411187770ec86e91904481ed3" data-api="https://kapilgarg.github.io/ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style><style>:root {--ghost-accent-color: #15171A;}</style>
    <!-- link tag -->

</head>
<body class="post-template tag-python tag-flask tag-browser tag-extension tag-sqlalchemy tag-sideproject tag-ideas has-cover">
<div class="viewport">

    <header id="gh-head" class="gh-head outer">
        <nav class="gh-head-inner inner">

            <div class="gh-head-brand">
                <a class="gh-head-logo no-image" href="https://kapilgarg.github.io">
                        basic function
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="https://kapilgarg.github.io/">Home</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>
                        <a class="gh-head-button" href="#/portal/signup" data-portal="signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
<article class="article post tag-python tag-flask tag-browser tag-extension tag-sqlalchemy tag-sideproject tag-ideas ">

    <header class="article-header gh-canvas">

        <div class="article-tag post-card-tags">
                <span class="post-card-primary-tag">
                    <a href="/tag/python/">python</a>
                </span>
        </div>

        <h1 class="article-title">Capture text from web with flask and JavaScript</h1>


        <div class="article-byline">
        <section class="article-byline-content">

            <ul class="author-list">
                <li class="author-list-item">
                    <a href="/author/kapil-2/" class="author-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg>
</a>
                </li>
            </ul>

            <div class="article-byline-meta">
                <h4 class="author-name"><a href="/author/kapil-2/">KAPIL</a></h4>
                <div class="byline-meta-content">
                    <time class="byline-meta-date" datetime="2020-12-26">Dec 26, 2020</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span>
                </div>
            </div>

        </section>
        </div>

            <figure class="article-image">
                <img
                    srcset="/content/images/size/w300/2020/12/janko-ferlic-sfL_QOnmy00-unsplash-2.jpg 300w,
                            /content/images/size/w600/2020/12/janko-ferlic-sfL_QOnmy00-unsplash-2.jpg 600w,
                            /content/images/size/w1000/2020/12/janko-ferlic-sfL_QOnmy00-unsplash-2.jpg 1000w,
                            /content/images/size/w2000/2020/12/janko-ferlic-sfL_QOnmy00-unsplash-2.jpg 2000w"
                    sizes="(min-width: 1400px) 1400px, 92vw"
                    src="/content/images/size/w2000/2020/12/janko-ferlic-sfL_QOnmy00-unsplash-2.jpg"
                    alt="Capture text from web with flask and JavaScript"
                />
            </figure>

    </header>

    <section class="gh-content gh-canvas">
        <p>We read a lot of stuff from web and sometimes would like to make a note of some of it so that we can refer to it later. There are a few products which charge few $/month and provide this service but we can easily write a browser extension to capture the text on a web page and save that to a database. Run this service locally if you need this on a single machine, on a raspberry pi in your home network or use a Amazon Lightsail. whatever suits you!!!</p><p>Here, I'm going to write a <em>basic browser extension and a web service</em> so that we can save the notes.</p><h3 id="browser-extension">Browser extension</h3><p>This is the first component which captures the highlights on a web page. Since browser doesn't exposes any event which <em>directly </em>gives you information about highlighted text , we are going to use <em>mouseup </em>event and <em>getSelection</em> window function for that.</p><p>Once you highlight a block of text (and release mouse's left button), check if there is any highlighted text available. If yes, insert a button element in the page and attach a handler to its click event. That's all this extension does.</p><figure class="kg-card kg-code-card"><pre><code class="language-javascript">function getSelected() {
    if (window.getSelection) {
        return window.getSelection();
    }
    else if (document.getSelection) {
        return document.getSelection();
    }
    else {
        var selection = document.selection &amp;&amp; document.selection.createRange();
        if (selection.text) {
            return selection.text;
        }
        return false;
    }
}</code></pre><figcaption>capture the selected text from a page</figcaption></figure><figure class="kg-card kg-code-card"><pre><code class="language-javascript">btnSave = $('&lt;button&gt;')
            .attr({
                type : 'button',
                id : 'btnsave'
            })
            .html('+')
            .css({
                'color' : 'red'
            }).hide();
            $(document.body).append(btnSave);</code></pre><figcaption>inject a button to html body</figcaption></figure><figure class="kg-card kg-code-card"><pre><code class="language-javascript">$('#btnsave').click(function  save(event) {
                event.preventDefault();
                var txt = $.trim(getSelected());
                // make an api call to save selected text
    		//...
                document.getElementById("btnsave").style.display="none";
            });</code></pre><figcaption>handler for button click</figcaption></figure><p>The code for this extension is available at <a href="https://github.com/kapilgarg/web-note/tree/master/extension/src">here</a>. You should be able to install the extension locally.</p><h3 id="web-api">Web API</h3><p>Browser extension calls this Web service to read or write . I'm using flask to write a web api which takes a block of text and saves it in database. The database I'm using here is Sqlite and SQLAlchemy as ORM.</p><h5 id="create-model">Create model </h5><p>lets call each record a Note. It has  following fields</p><ul><li>text - highlighted text from web page </li><li>source - url of the web page </li><li>tags - tags which provide additional details</li><li>comments - in case you want to add something</li><li>createdon/modifiedon - audit fields</li></ul><figure class="kg-card kg-code-card"><pre><code class="language-python">"""
all models 
"""
import datetime
from sqlalchemy import Column, Integer, String
from database import Base



class Note(Base):
    """
    represent a note record
    """
    __tablename__ = 'note'
    id = Column(Integer, primary_key=True,)
    user_id = Column(String(50), nullable=False)
    text = Column(String(500), nullable=False)
    source = Column(String(200), nullable=False)
    tags = Column(String(500), default='')
    comments = Column(String(500), default='')
    created_on = Column(String(20), default=datetime.datetime.utcnow())
    modified_on = Column(String(20), default=datetime.datetime.utcnow())

    def __init__(self, user_id, text, source):
        self.user_id = user_id
        self.text = text
        self.source = source

    def serialize(self):</code></pre><figcaption>models.py</figcaption></figure><h5 id="setup-database">Setup database</h5><p>To set up database, we are providing the db file path as db location and a function to create all tables as per the model.</p><figure class="kg-card kg-code-card"><pre><code class="language-python">from sqlalchemy import create_engine
from sqlalchemy.orm import scoped_session, sessionmaker
from sqlalchemy.ext.declarative import declarative_base

DATABASE = "web-note.db"

engine = create_engine('sqlite:///'+DATABASE, convert_unicode=True)
db_session = scoped_session(sessionmaker(autocommit=False,
                                         autoflush=False,
                                         bind=engine))

Base = declarative_base()
Base.query = db_session.query_property()


def init_db():
    """
    initialize the db
    """
    # import all modules here that might define models so that
    # they will be registered properly on the metadata.  Otherwise
    # you will have to import them first before calling init_db()
    import models
    Base.metadata.create_all(bind=engine)</code></pre><figcaption>database.py</figcaption></figure><h5 id="create-routes">Create routes</h5><p>we are creating primarily 3 routes - </p><ul><li>Get all the notes  - This uses query.all() to return all the notes from db. Note that there are some issue in serializing these records by sqlAlchemy</li><li>Save a note</li><li>Get a note by Id </li></ul><figure class="kg-card kg-code-card"><pre><code class="language-python">"""
"""
import json
import flask
from flask import request, render_template
from models import Note
from database import db_session


app = flask.Flask(__name__)
app.config["DEBUG"] = True


@app.route('/', methods=['GET'])
def home():
    """
    Home
    """
    all_notes = [note.serialize() for note in  Note.query.all()]
    return render_template('index.html', notes=all_notes) 


@app.route('/notes', methods=['POST'])
def notes():
    """
    handler for /notes
    """
    data = request.data.decode('UTF-8')
    data = json.loads(data)
    if data:
        _save_note(data)
    return {'status': 'success'}               

def _save_note(data):
    note = Note(user_id=data.get('user_id'), text=data.get(
                'text'), source=data.get('source'))
    db_session.add(note)
    db_session.commit()</code></pre><figcaption>note_app.py</figcaption></figure><p>This is a very basic setup to get what we want. To save the note, we use SQLAlchemy's db_session. To get the list of notes from DB, we use query.all() and render it using jinja.</p><p>We need to call the <em>init_db</em> from database.py in order to create all the tables as per the models and then we are set to go.</p><pre><code class="language-python">&gt;&gt;from database import init_db
&gt;&gt;init_db()
&gt;&gt;python note_app.py</code></pre><p>Code for this is available <a href="https://github.com/kapilgarg/web-note/tree/master/web_api/src">here</a>. </p><p>All the set up is running locally (on 127.0.0.1). Make the necessary changes if you need to deploy this on any server and access it .</p><hr>
    </section>


</article>
</main>

    <section class="footer-cta outer">
        <div class="inner">
            <h2 class="footer-cta-title">Sign up for more like this.</h2>
            <a class="footer-cta-button" href="#/portal" data-portal>
                <div class="footer-cta-input">Enter your email</div>
                <span>Subscribe</span>
            </a>
        </div>
    </section>



            <aside class="read-more-wrap outer">
                <div class="read-more inner">
                        
<article class="post-card post post-access-public">

    <a class="post-card-image-link" href="/coming-soon/">

        <img class="post-card-image"
            srcset="https://static.ghost.org/v4.0.0/images/feature-image.jpg 300w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 600w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 1000w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="https://static.ghost.org/v4.0.0/images/feature-image.jpg"
            alt="Coming soon"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/coming-soon/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Coming soon
                </h2>
            </header>
                <div class="post-card-excerpt">This is basic function, a brand new site by kapil that's just getting started. Things will be up and running here shortly, but you can subscribe in the meantime if you'd like to stay up to date and receive emails when new content is published!</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-05-30">May 30, 2022</time>
        </footer>

    </div>

</article>
                        
<article class="post-card post featured no-image post-access-public">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/mock-environment-variable-in-unittest/">
            <header class="post-card-header">
                <div class="post-card-tags">
                        <span class="post-card-featured"><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M4.49365 4.58752C3.53115 6.03752 2.74365 7.70002 2.74365 9.25002C2.74365 10.6424 3.29678 11.9778 4.28134 12.9623C5.26591 13.9469 6.60127 14.5 7.99365 14.5C9.38604 14.5 10.7214 13.9469 11.706 12.9623C12.6905 11.9778 13.2437 10.6424 13.2437 9.25002C13.2437 6.00002 10.9937 3.50002 9.16865 1.68127L6.99365 6.25002L4.49365 4.58752Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
</svg> Featured</span>
                </div>
                <h2 class="post-card-title">
                    Mock environment variable in unittest
                </h2>
            </header>
                <div class="post-card-excerpt">While writing test cases, you may need to mock one or more environment variables. It could be because environment variable it used as a flag for certain functionality or something else.

Environment variables are available through os.environ api. Though technically os.environ [1] is not a dictionary but it</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-03-08">Mar 8, 2022</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">2 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post no-image post-access-public">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/write-a-file-watcher-and-read-the-delta/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Write a file-watcher and read the delta...
                </h2>
            </header>
                <div class="post-card-excerpt">While working on an on-premise compute grid, there was a need to monitor the status of various jobs running on worker nodes. There is a scheduler which assign tasks to worker nodes and maintains the status of each job. As a job moves through various stages of its life cycle,</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-02-20">Feb 20, 2022</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">1 min read</span>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="https://kapilgarg.github.io">basic function</a> &copy; 2022</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="/assets/built/casper.js?v=776d70e7aa"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<!-- script tag -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-169335725-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-169335725-1');
</script>

</body>
</html>
