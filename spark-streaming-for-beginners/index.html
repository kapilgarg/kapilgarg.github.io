<!DOCTYPE html>
<html lang="en">
<head>

    <title>Spark Streaming for beginners</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=776d70e7aa" />

    <link rel="canonical" href="https://kapilgarg.github.io/spark-streaming-for-beginners/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://kapilgarg.github.io/spark-streaming-for-beginners/amp/" />
    
    <meta property="og:site_name" content="basic function" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Spark Streaming for beginners" />
    <meta property="og:description" content="Whether you are running an eCommerce store and want  to put up a dash board which shows the number of  orders processed every minute or run a very popular blog and would like to display trending articles on your web site or any other scenarios like this, all of these" />
    <meta property="og:url" content="https://kapilgarg.github.io/spark-streaming-for-beginners/" />
    <meta property="article:published_time" content="2021-06-13T18:34:29.000Z" />
    <meta property="article:modified_time" content="2021-06-13T18:53:37.000Z" />
    <meta property="article:tag" content="pyspark" />
    <meta property="article:tag" content="streaming" />
    <meta property="article:tag" content="python" />
    <meta property="article:tag" content="apache spark" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Spark Streaming for beginners" />
    <meta name="twitter:description" content="Whether you are running an eCommerce store and want  to put up a dash board which shows the number of  orders processed every minute or run a very popular blog and would like to display trending articles on your web site or any other scenarios like this, all of these" />
    <meta name="twitter:url" content="https://kapilgarg.github.io/spark-streaming-for-beginners/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="KAPIL" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="pyspark, streaming, python, apache spark" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "basic function",
        "url": "https://kapilgarg.github.io/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://kapilgarg.github.io/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "KAPIL",
        "url": "https://kapilgarg.github.io/author/kapil-2/",
        "sameAs": []
    },
    "headline": "Spark Streaming for beginners",
    "url": "https://kapilgarg.github.io/spark-streaming-for-beginners/",
    "datePublished": "2021-06-13T18:34:29.000Z",
    "dateModified": "2021-06-13T18:53:37.000Z",
    "keywords": "pyspark, streaming, python, apache spark",
    "description": "Whether you are running an eCommerce store and want  to put up a dash board which shows the number of  orders processed every minute or run a very popular blog and would like to display trending articles on your web site or any other scenarios like this, all of these require the processing of data in real time. We may be getting thousands of orders per minutes or hundreds of thousands of page view per minutes. What we need to do is process that stream of data on the fly so that the result is ava",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://kapilgarg.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.1" />
    <link rel="alternate" type="application/rss+xml" title="basic function" href="https://kapilgarg.github.io/rss/" />
    <script defer src="https://unpkg.com/@tryghost/portal@~2.1.0/umd/portal.min.js" data-ghost="https://kapilgarg.github.io/" data-key="6411187770ec86e91904481ed3" data-api="https://kapilgarg.github.io/ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style><style>:root {--ghost-accent-color: #15171A;}</style>
    <!-- link tag -->

</head>
<body class="post-template tag-pyspark tag-streaming tag-python tag-apache-spark has-cover">
<div class="viewport">

    <header id="gh-head" class="gh-head outer">
        <nav class="gh-head-inner inner">

            <div class="gh-head-brand">
                <a class="gh-head-logo no-image" href="https://kapilgarg.github.io">
                        basic function
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="https://kapilgarg.github.io/">Home</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>
                        <a class="gh-head-button" href="#/portal/signup" data-portal="signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
<article class="article post tag-pyspark tag-streaming tag-python tag-apache-spark no-image ">

    <header class="article-header gh-canvas">

        <div class="article-tag post-card-tags">
                <span class="post-card-primary-tag">
                    <a href="/tag/pyspark/">pyspark</a>
                </span>
        </div>

        <h1 class="article-title">Spark Streaming for beginners</h1>


        <div class="article-byline">
        <section class="article-byline-content">

            <ul class="author-list">
                <li class="author-list-item">
                    <a href="/author/kapil-2/" class="author-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg>
</a>
                </li>
            </ul>

            <div class="article-byline-meta">
                <h4 class="author-name"><a href="/author/kapil-2/">KAPIL</a></h4>
                <div class="byline-meta-content">
                    <time class="byline-meta-date" datetime="2021-06-14">Jun 14, 2021</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span>
                </div>
            </div>

        </section>
        </div>


    </header>

    <section class="gh-content gh-canvas">
        <p>Whether you are running an eCommerce store and want  to put up a dash board which shows the number of  orders processed every minute or run a very popular blog and would like to display trending articles on your web site or any other scenarios like this, all of these require the processing of data in real time. We may be getting thousands of orders per minutes or hundreds of thousands of page view per minutes. What we need to do is process that stream of data on the fly so that the result is available with minimum latency.</p><p><strong>Spark streaming</strong> is capable of processing data stream in a <em>distributed manner with high throughput and scalability</em>.  It can read the stream from multiple sources like files, over TCP connection, Kafka, Kinesis etc. Lets take an example of eCommerce store and see how to get the numbers of orders processed per minute from continuous stream.</p><p>We have a TCP server which acts as source for stream. Spark Streaming app connects to this server to receive the data. In real world, this TCP server may be replaced with Kafka, Kinesis etc. </p><p>Once we start the TCP server and start spark app, spark app starts reading stream from server. Here is the spark code and records look like when spark reads it.</p><pre><code class="language-python">session = SparkSession.builder.master("local[2]")\
        .appName("PythonStreamingOrderCount")\
        .config("spark.ui.showConsoleProgress", "false")\
        .getOrCreate()

sc = session.sparkContext
sc.setLogLevel("ERROR")
ssc = StreamingContext(sc, 5)

orders = ssc.socketTextStream(sys.argv[1], int(sys.argv[2]))
orders.pprint()</code></pre><pre><code># start the TCP server
python server.py

#start spark app
python .\order_count.py localhost 9998</code></pre><figure class="kg-card kg-image-card"><img src="https://kapilgarg.github.io/content/images/2021/06/image.png" class="kg-image" alt loading="lazy" width="683" height="277" srcset="https://kapilgarg.github.io/content/images/size/w600/2021/06/image.png 600w, https://kapilgarg.github.io/content/images/2021/06/image.png 683w"></figure><p>ssc is the streaming context which reads the stream from source every 5 seconds. Object <em>orders </em>is of type <em>pyspark.streaming.dstream.DStream. </em>This is an abstraction provided in pyspark streaming api and is represented as sequence of Rdds. Each record in the DStream is an Rdd. </p><p>This is only input stream without any transformation. If we want to get the numbers of orders by their status every 5 seconds, we can apply some higher level functions on this DStream and process this data.</p><pre><code class="language-python">session = SparkSession.builder.master("local[2]")\
        .appName("PythonStreamingOrderCount")\
        .config("spark.ui.showConsoleProgress", "false")\
        .getOrCreate()
        
sc = session.sparkContext
sc.setLogLevel("ERROR")
ssc = StreamingContext(sc, 5)
    
orders = ssc.socketTextStream(sys.argv[1], int(sys.argv[2]))

orders = orders.map(lambda rdd: json.loads(rdd))\
.map(lambda r: (r['status'], 1))\
.reduceByKey(lambda a, b: a+b)

orders.pprint()

ssc.start()
ssc.awaitTermination()</code></pre><p>Since each rdd is a string, we convert that to a dictionary, group by order status and add the frequency of each order in that group.here is the output.</p><figure class="kg-card kg-image-card"><img src="https://kapilgarg.github.io/content/images/2021/06/test.gif" class="kg-image" alt loading="lazy" width="635" height="611" srcset="https://kapilgarg.github.io/content/images/size/w600/2021/06/test.gif 600w, https://kapilgarg.github.io/content/images/2021/06/test.gif 635w"></figure><p>Every 5 second window, spark process the receive records and calculates the how many orders were sent by their status.</p><p>You could also get the updated total count of all the orders by status in addition to the current 5 minutes count.</p><pre><code>def update(new_values, current_values):
    current_values = current_values or 0    
    return sum(new_values, current_values)
 
 total_count = orders.updateStateByKey(update)
 total_count.pprint()</code></pre><p>update function keeps the state updated by adding new values to the current values so that we have a cumulative count available for each key (status)</p><figure class="kg-card kg-image-card"><img src="https://kapilgarg.github.io/content/images/2021/06/image-2.png" class="kg-image" alt loading="lazy" width="854" height="675" srcset="https://kapilgarg.github.io/content/images/size/w600/2021/06/image-2.png 600w, https://kapilgarg.github.io/content/images/2021/06/image-2.png 854w" sizes="(min-width: 720px) 720px"></figure><p></p><h3 id="high-level-components-of-spark-streaming">High level components of spark streaming </h3><figure class="kg-card kg-image-card"><img src="https://kapilgarg.github.io/content/images/2021/06/spark-streaming-1.png" class="kg-image" alt loading="lazy" width="957" height="496" srcset="https://kapilgarg.github.io/content/images/size/w600/2021/06/spark-streaming-1.png 600w, https://kapilgarg.github.io/content/images/2021/06/spark-streaming-1.png 957w" sizes="(min-width: 720px) 720px"></figure><p>We will look at other API of spark streaming and how those can be used in different use cases next time. </p><p>source code for this sample is available at <a href="https://github.com/kapilgarg/spark-streaming-samples">https://github.com/kapilgarg/spark-streaming-samples</a></p><p>Ref: <a href="https://spark.apache.org/docs/latest/streaming-programming-guide.html">https://spark.apache.org/docs/latest/streaming-programming-guide.html</a></p>
    </section>


</article>
</main>

    <section class="footer-cta outer">
        <div class="inner">
            <h2 class="footer-cta-title">Sign up for more like this.</h2>
            <a class="footer-cta-button" href="#/portal" data-portal>
                <div class="footer-cta-input">Enter your email</div>
                <span>Subscribe</span>
            </a>
        </div>
    </section>



            <aside class="read-more-wrap outer">
                <div class="read-more inner">
                        
<article class="post-card post post-access-public">

    <a class="post-card-image-link" href="/coming-soon/">

        <img class="post-card-image"
            srcset="https://static.ghost.org/v4.0.0/images/feature-image.jpg 300w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 600w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 1000w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="https://static.ghost.org/v4.0.0/images/feature-image.jpg"
            alt="Coming soon"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/coming-soon/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Coming soon
                </h2>
            </header>
                <div class="post-card-excerpt">This is basic function, a brand new site by kapil that's just getting started. Things will be up and running here shortly, but you can subscribe in the meantime if you'd like to stay up to date and receive emails when new content is published!</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-05-30">May 30, 2022</time>
        </footer>

    </div>

</article>
                        
<article class="post-card post featured no-image post-access-public">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/mock-environment-variable-in-unittest/">
            <header class="post-card-header">
                <div class="post-card-tags">
                        <span class="post-card-featured"><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M4.49365 4.58752C3.53115 6.03752 2.74365 7.70002 2.74365 9.25002C2.74365 10.6424 3.29678 11.9778 4.28134 12.9623C5.26591 13.9469 6.60127 14.5 7.99365 14.5C9.38604 14.5 10.7214 13.9469 11.706 12.9623C12.6905 11.9778 13.2437 10.6424 13.2437 9.25002C13.2437 6.00002 10.9937 3.50002 9.16865 1.68127L6.99365 6.25002L4.49365 4.58752Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
</svg> Featured</span>
                </div>
                <h2 class="post-card-title">
                    Mock environment variable in unittest
                </h2>
            </header>
                <div class="post-card-excerpt">While writing test cases, you may need to mock one or more environment variables. It could be because environment variable it used as a flag for certain functionality or something else.

Environment variables are available through os.environ api. Though technically os.environ [1] is not a dictionary but it</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-03-08">Mar 8, 2022</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">2 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post no-image post-access-public">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/write-a-file-watcher-and-read-the-delta/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Write a file-watcher and read the delta...
                </h2>
            </header>
                <div class="post-card-excerpt">While working on an on-premise compute grid, there was a need to monitor the status of various jobs running on worker nodes. There is a scheduler which assign tasks to worker nodes and maintains the status of each job. As a job moves through various stages of its life cycle,</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-02-20">Feb 20, 2022</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">1 min read</span>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="https://kapilgarg.github.io">basic function</a> &copy; 2022</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="/assets/built/casper.js?v=776d70e7aa"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<!-- script tag -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-169335725-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-169335725-1');
</script>

</body>
</html>
